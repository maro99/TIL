# Session and Cookie     

## 내머리에 들어있는것들 적어봄   
세션과 쿠키는 웹서비스에서 유저의 연속성을 지원하기 위해 고안된것.  
이것이없으면 http의 통신 구조상 (유저가 접속한 브라우저<클라이언트> 가  서버에 웹페이지  요청 -> 그것에 대한 응답을 받는 구조. 이 연결이 전화처럼 양방향으로 실시간으로 이어져 있지 않다.)  유저가 우리의 웹사이트를 돌아다니면서 장바구니에 물건을 담는다거나, 로긴 상태를 유지한다던가 할 수없다.  새션은 서버 안에 있는 것이고 쿠키는 브라우저 가 가지고 있는 저장 공간인데  이것을 이용한다.   
예를 들어 유저가 로긴요청을 보내왔을때 서버에서 이 요청에 대한 유저 인증 후 어떤 회원이 로긴 중이라는 정보를 담아서 브라우저에 보내고 브라우저는 이것을 쿠키에 저장한다. 서버 상의 세션이라는 저장공간에는 브라우저에 전달한 쿠키 에 맞는 counterpart 즉 아이디와 비번같이 앞으로 브라우저가 요청에 넣어서 그 요청이 가령 로긴을 한 상태인지 확인할 기준이될 데이터를 가지고 있는다.(혹은 로긴을 안한 장바구니 같은 경우에는 브라우저로 요청을 이번에 받기전의 장바구니 상태 등? )   그리고 유저는 앞으로의 우리 사이트에서의 웹서핑 과정에서 의 모든 요청에 서버로 부터 전달받은 이 쿠키를 저장해 놓는데
이것을 앞으로의 요청의 header에 첨부해서 서버에 보내고 서버는 이것을 보고 유저가 지금 로긴 중인지, 몇개째 아이스크림을 장바구니에 담았는지 등을 알수있다. 추후 로그 아웃시에는 이 쿠키를 삭제해서 유저의 로그인 유무를 확인 할 수 있다.    


세션과 쿠키는 어떤 저장소라는점이 같지만 유효기간이 다르다.(맞나?)  
세션같은 경우는 서버안에 있어서 안전하지만 쿠키 같은 경우는 브라우저의 저장공간에 위치하기 때문에 탈취 위험이 있고 유효기간이 더 짧다.   



## 떠오른질문.   
1. session과 cookie에 실질적으로 저장되는 데이터 값은? (장고 배우면서 배운듯?)     
2. 이런 과정에서 보안은 어떻게 이루어지는지?  
3. 웹 을 돌아다니다 보면 쿠키가 쌓이는데. 로긴, 장바구니 등 말고 어디에 쓰이나?   
4. session이 만료됬다는 뜻은?   
5. cookie와 cache의 차이는? cache도 결국에는 왔던거, 한번 해봤던거 빠르게 할라고 인메모리 (ram)에 저장 하는것 아닌가? 추측 -> 저장되는 위치가 disk인지 ram인지의 차이인듯.     


## 질문에 대한 답변.
**session과 cookie에 실질적으로 저장되는 데이터 값은?**  
- 유저가 로긴하고 장바구니에 물건 담아 돌아다니는 경우를 생각해보면 유저가 로긴 -> 서버가 세션을 생성 -> **세션id**가 쿠키에 저장-> 유저가 로그인 상태로 있는동안 이 쿠키가 모든 request에 담아져서 보내짐 -> request받은 서버가 쿠키에 담긴 세선 id와 서버 메모리?에 담긴 **세션정보**를비교해서 유저의 신원을 확인 및 그에 알맞은 응답을 보내준다.  
    
[장바구니 정보를 sesseion혹은 db에 저장해야 하나? ](https://stackoverflow.com/questions/2827764/ecommerceshopping-cartwhere-should-i-store-shopping-cart-data-in-session-or) 찾아봄.  
**비회원경우**: websotrage(클라이언트에 데이터 저장하도록 지원하는 html5기능. 쿠키는 4kb, 웹스는 5mb, 로컬 스토리지<반영구,도메인 다른경우 분리> 와 세선 스토리지<세션 종료시 삭제 도메인 같아도 세션별로 분리> 가 있다.쿠키의단점 -> 웹요청마다 쿠키 전달되어 불필요한 요청값 포함,값설정및조회 api부제, 서버측전송으로 도난가능성 등. 을 보완하기위해 사용. )혹은 쿠키 에 저장. 이후 회원가입을 이 회원이 진행하면 그 데이터 들을 db에 넣어주면 된다.     
**회원인경우**: 당연히 db에 저장해야 한다.  

**django 수업때 session이 실제 sql파일 안에 저장됬는데 그렇다면 세션은 db에 저장되는것인가?**:  
- session은 정확히 메모리상에 존재하는 객체이다. 사용자 관련 정보를 세션에 저장하고(유저가 로긴정보,장바구니 등  관리하기 힘들다 판단<보안상의 이유?> ) 그 세션 아이디만브라우저에 쿠키형태로 저장하는것.  
- 메모리or Cache DB에 저장한다.  
- 임시 디렉토리에 textfile형태로 저장된다함.[참고](https://stackoverflow.com/questions/5593359/where-does-session-save)

**django 수업때 확인한 session cookie저장값은?**:   
-sesseion: db의 django-sessions 에 sessionkey, session data   
"oimkzbhf0kyfm21" "y5Nb2RlbEJhY2tlbmQiLCJfYXV0aF91c2VYzNmU4ZTFkZDIwIn0=" "2018-07-06 02:12:14.109507"  이런식으로 저장됨.   
-cookie: 계발자 도구로 localhost:8000에서 sessionid, value값 위와 일치하는것 확인 할수 있었고 따로 expired data2주후가 되어있었다.  
(부연설명하면 sessions.py INSTALLED_APPS=['django.contrib.sessions',] 이 어플리케이션 안에서 
session middleware라는 친구가 요청과 응답 사이에서 어떤 사용자 요청을 했는지 관리를 해준다.)     

**보안 어떻게 이뤄지는지**:  
- 로긴후 session에 대한 id가 쿠키에 저장되면 이것 탈취후 헤더에 넣어 요청 보내면 공격자는 정확히 해당 유저 아이디로 로긴한것과 같지 않나?-->그렇다. 쿠키에 저장된 세션 id를 지우지 않으면 (로그아웃시 세션아이디 삭제된다) 이것 가지고 로긴 할수있다.   
- http통신을 할 경우 sessionid값 담은 클라 -> 서버 요청이 탈취당하면 (아주쉽게 탈취가능하다함.) 털린다.그래서 https통신을 하는것.   
- https일때만 웹브라우저가 쿠키를 서버로 정송하는 **Secure**옵션  
- 자바스크립트 document.cookie를 이용해서 쿠키에 접속하는것을 막는 **HttpOnly**옵션으로 쿠키 훔쳐가는 행위막을수 있다함.   
- [참고](https://opentutorials.org/course/3387/21744)  

**세션과 쿠키 다른점.**  
- 저장위치 : 쿠키는 클라이언트, 세션은 서버에 저장.   
- 저장형태: 쿠키는 텍스트 형식(키,벨류?), 세션은 object형으로 메모리에 저장.  
- 만료기간: 쿠키는 저장시 설정 안했으면 브라우져 종료시 소멸, 세션은 정확한 시점 알 수없음.(세션은 클라이언트 측에서 로그아웃 하거나 설정한 시간동안 클라이언트측 반응 없을 경우에만 만료 된다는데...)      
- 자원:  쿠키는 클라이언트, 세션은 서버 자원 사용.  
- 용량: 쿠키는 한도메인,20개 쿠키당 4kb총 300개, 세션은 서버 허용하는한 용량제한 x    
- 속도: 당연히 브라우저 입장에서 쿠키정보 가져오는게빠름. 세션의정보 는 서버에서 처리 거쳐서 가져와서 비교적 느림.

**cookie와 cache의 차이는, session과 cache의 차이는?**:  
- 캐시 : 이미지나 css,js파일등이 사용자의 브라우저에 저장되는것.(단순히 웹페이지 디스플레이 빠르게 하기위해 다운로드된 데이터 집합)  이를 이용해 자원 아끼고, 한번 캐시에 저장되면 브라우저를 참고하기 때문에 서버에서 변경이 되어도 사용자는 변경되지 않게 보일수 있는데 이런 부분을 캐시를 지워주거나 서버에서 클라이언트로 응답 보낼 때 header에 캐시 만료 시간을 명시하는 방법을 이용할 수 있다.   
- 목적이 다르다. 쿠키는 유저각각의 특징?(characteristics)을 추척(track)하기 위함. 캐시는 웹페이지 로딩을 빠르게 하기 위함.    
- 쿠키는 유저의 기호등을 저장, 캐시는 오디오비디오플레시파일 등 저장.   
- 쿠키는 만료시점 금방이지만, 캐시는 유저가 직접 삭제하기 까지 남아있음.  
[참고](https://medium.com/techblogout/whats-the-difference-between-cache-and-cookies-53e7f4f094bb)  




**cookie session추가적 사용 사례**:  
- 쿠키: 자동 팝업 오늘은 더이상 보지 않음 체크.(세션에 이런정보 저장해도 되지만. 서버 자원 아끼기위함.)  


## 찾아본 내용  
에버노트 스크렙되어있던 내용 좋아서 이것으로 대처. 
[에버노트](https://www.evernote.com/shard/s372/sh/8d675dc5-95a4-4e77-abdc-bbccd713c020/44cba949e9b2916c6963cf52b6e82a0d)
     
